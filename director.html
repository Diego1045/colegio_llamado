<!DOCTYPE html>
<html lang="es" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Directora - Colegio Albert Einstein</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#1e40af',
                    }
                }
            }
        }
    </script>
    <style>
        .dark {
            color-scheme: dark;
        }
        .dark body {
            background-color: #1a1a1a;
            color: #FFFFFF;
        }
        .dark .bg-white {
            background-color: #2d2d2d;
        }
        .dark .text-gray-800 {
            color: #FFFFFF;
        }
        .dark .border-gray-200 {
            border-color: #404040;
        }
        .dark .bg-gray-50 {
            background-color: #333333;
        }
        .dark .text-gray-500 {
            color: #FFFFFF;
        }
        .dark .bg-gray-100 {
            background-color: #404040;
        }
        .dark .hover\:bg-gray-100:hover {
            background-color: #4d4d4d;
        }
        .dark .bg-purple-600 {
            background-color: #7c3aed;
        }
        .dark .hover\:bg-purple-700:hover {
            background-color: #6d28d9;
        }
        .dark .bg-green-100 {
            background-color: #064e3b;
        }
        .dark .text-green-800 {
            color: #6ee7b7;
        }
        .dark table {
            border-color: #404040;
        }
        .dark th {
            background-color: #333333;
            color: #f3f4f6;
        }
        .dark td {
            border-color: #404040;
        }
        .dark .text-red-600 {
            color: #f87171;
        }
        .dark .hover\:text-red-900:hover {
            color: #ef4444;
        }
        .dark .text-gray-600 {
            color: #FFFFFF;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <div class="fixed top-4 right-4">
        <button id="themeToggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700">
            <i class="fas fa-sun text-yellow-500 dark:hidden"></i>
            <i class="fas fa-moon text-blue-300 hidden dark:block"></i>
        </button>
    </div>
    <!-- Header -->
    <header class="bg-purple-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-user-shield text-3xl"></i>
                    <h1 class="text-2xl font-bold">Panel de Directora</h1>
                </div>
                <a href="index.html" class="text-white hover:text-purple-200 transition">
                    <i class="fas fa-arrow-left mr-2"></i>Volver al inicio
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Login Section -->
        <section id="loginSection" class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden p-8">
            <div class="text-center mb-6">
                <i class="fas fa-lock text-5xl text-purple-500 mb-4"></i>
                <h2 class="text-2xl font-bold text-gray-800">Acceso Directora</h2>
                <p class="text-gray-600 mt-2">Ingresa tus credenciales para acceder al panel</p>
            </div>
            <form id="loginForm" class="space-y-6">
                <div>
                    <label for="directorEmail" class="block text-sm font-medium text-gray-700 mb-1">Correo Electrónico</label>
                    <input type="email" id="directorEmail" required 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                </div>
                <div>
                    <label for="directorPassword" class="block text-sm font-medium text-gray-700 mb-1">Contraseña</label>
                    <input type="password" id="directorPassword" required 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                </div>
                <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-lg transition duration-300">
                    Iniciar Sesión
                </button>
            </form>
        </section>

        <!-- Dashboard Section (Hidden by default) -->
        <section id="dashboardSection" class="hidden max-w-4xl mx-auto">
            <div class="bg-white rounded-xl shadow-md overflow-hidden p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Generador de Códigos de Invitación</h2>
                <div class="space-y-6">
                    <div class="flex items-center space-x-4">
                        <input type="number" id="codeQuantity" min="1" max="10" value="1" 
                               class="w-20 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        <button id="generateCodesBtn" class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-lg transition duration-300">
                            <i class="fas fa-key mr-2"></i>Generar Códigos
                        </button>
                    </div>
                    <div id="generatedCodes" class="space-y-4">
                        <!-- Los códigos generados aparecerán aquí -->
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-md overflow-hidden p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Códigos Generados</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Código</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha de Generación</th>
                            </tr>
                        </thead>
                        <tbody id="codesTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Los códigos se mostrarán aquí -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Cuentas de Padres -->
            <div class="bg-white rounded-xl shadow-md overflow-hidden p-8 mt-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Cuentas de Padres</h2>
                    <div class="relative">
                        <input type="text" id="searchInput" 
                               class="w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                               placeholder="Buscar por nombre, correo o hijo...">
                        <button onclick="searchParents()" 
                                class="absolute right-2 top-1/2 transform -translate-y-1/2 text-purple-600 hover:text-purple-800">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Correo</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hijos Registrados</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="parentsTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Las cuentas de padres se mostrarán aquí -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-100 border-t border-gray-200 py-6 mt-12">
        <div class="container mx-auto px-4 text-center text-gray-600">
            <p>© 2023 Colegio Albert Einstein. Todos los derechos reservados.</p>
            <p class="mt-2 text-sm">Panel de Administración - Uso exclusivo de la directora</p>
        </div>
    </footer>

    <script>
        // Credenciales de la directora (en un caso real, esto estaría en un servidor)
        const DIRECTOR_EMAIL = "t@gmail.com";
        const DIRECTOR_PASSWORD = "u";

        // DOM Elements
        const loginSection = document.getElementById('loginSection');
        const dashboardSection = document.getElementById('dashboardSection');
        const loginForm = document.getElementById('loginForm');
        const generateCodesBtn = document.getElementById('generateCodesBtn');
        const generatedCodes = document.getElementById('generatedCodes');
        const codesTableBody = document.getElementById('codesTableBody');
        const parentsTableBody = document.getElementById('parentsTableBody');
        const searchInput = document.getElementById('searchInput');

        // Event Listeners
        loginForm.addEventListener('submit', handleLogin);
        generateCodesBtn.addEventListener('click', handleGenerateCodes);
        searchInput.addEventListener('input', searchParents);

        function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('directorEmail').value;
            const password = document.getElementById('directorPassword').value;
            
            if (email === DIRECTOR_EMAIL && password === DIRECTOR_PASSWORD) {
                loginSection.classList.add('hidden');
                dashboardSection.classList.remove('hidden');
                loadExistingCodes();
                loadParentsAccounts();
            } else {
                alert('Credenciales incorrectas. Por favor, intente nuevamente.');
            }
        }

        function handleGenerateCodes() {
            const quantity = parseInt(document.getElementById('codeQuantity').value);
            const codes = [];
            
            for (let i = 0; i < quantity; i++) {
                const code = generateNewCode();
                codes.push(code);
                saveCodeToStorage(code);
            }
            
            displayGeneratedCodes(codes);
            loadExistingCodes();
        }

        function generateNewCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            code += '-';
            
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            return code;
        }

        function saveCodeToStorage(code) {
            try {
                const codes = JSON.parse(localStorage.getItem('invitationCodes') || '[]');
                // Verificar si el código ya existe
                const codeExists = codes.some(codeData => codeData.code === code);
                if (!codeExists) {
                    codes.push({
                        code,
                        status: 'Disponible',
                        date: new Date().toLocaleString()
                    });
                    localStorage.setItem('invitationCodes', JSON.stringify(codes));
                    console.log('Código guardado exitosamente:', code);
                } else {
                    console.log('El código ya existe:', code);
                }
            } catch (error) {
                console.error('Error al guardar el código:', error);
            }
        }

        function displayGeneratedCodes(codes) {
            generatedCodes.innerHTML = '';
            codes.forEach(code => {
                const codeElement = document.createElement('div');
                codeElement.className = 'flex items-center justify-between p-4 bg-gray-50 rounded-lg';
                codeElement.innerHTML = `
                    <span class="font-mono text-lg">${code}</span>
                    <button class="copy-btn text-purple-600 hover:text-purple-800" data-code="${code}">
                        <i class="fas fa-copy"></i>
                    </button>
                `;
                generatedCodes.appendChild(codeElement);
            });

            // Add copy functionality
            document.querySelectorAll('.copy-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const code = this.getAttribute('data-code');
                    navigator.clipboard.writeText(code).then(() => {
                        const originalHTML = this.innerHTML;
                        this.innerHTML = '<i class="fas fa-check"></i>';
                        setTimeout(() => {
                            this.innerHTML = originalHTML;
                        }, 2000);
                    });
                });
            });
        }

        function loadExistingCodes() {
            const codes = JSON.parse(localStorage.getItem('invitationCodes') || '[]');
            codesTableBody.innerHTML = '';
            
            // Filtrar solo códigos disponibles
            const availableCodes = codes.filter(codeData => codeData.status === 'Disponible');
            
            if (availableCodes.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" class="px-6 py-4 text-center text-gray-500">
                        No hay códigos disponibles
                    </td>
                `;
                codesTableBody.appendChild(row);
                return;
            }
            
            availableCodes.forEach(codeData => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap font-mono">${codeData.code}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                            ${codeData.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${codeData.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <!-- No se muestra botón de papelera para códigos disponibles -->
                    </td>
                `;
                codesTableBody.appendChild(row);
            });
        }

        function searchParents() {
            const searchTerm = searchInput.value.toLowerCase();
            const parents = JSON.parse(localStorage.getItem('registeredParents') || '[]');
            
            if (!searchTerm) {
                loadParentsAccounts();
                return;
            }

            const filteredParents = parents.filter(parent => {
                // Buscar en nombre del padre
                if (parent.name.toLowerCase().includes(searchTerm)) {
                    return true;
                }
                
                // Buscar en correo del padre
                if (parent.email.toLowerCase().includes(searchTerm)) {
                    return true;
                }
                
                // Buscar en nombres de los hijos
                return parent.children.some(child => 
                    child.name.toLowerCase().includes(searchTerm)
                );
            });

            displayFilteredParents(filteredParents);
        }

        function displayFilteredParents(parents) {
            parentsTableBody.innerHTML = '';
            
            if (parents.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" class="px-6 py-4 text-center text-gray-500">
                        No se encontraron resultados
                    </td>
                `;
                parentsTableBody.appendChild(row);
                return;
            }
            
            parents.forEach(parent => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${parent.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${parent.email}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="space-y-1">
                            ${parent.children.map(child => `
                                <div class="text-sm text-gray-600">
                                    ${child.name} - ${child.grade}
                                </div>
                            `).join('')}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <button onclick="deleteParentAccount('${parent.email}')" 
                                class="text-red-600 hover:text-red-900 font-medium">
                            <i class="fas fa-trash-alt"></i> Eliminar
                        </button>
                    </td>
                `;
                parentsTableBody.appendChild(row);
            });
        }

        function loadParentsAccounts() {
            const parents = JSON.parse(localStorage.getItem('registeredParents') || '[]');
            displayFilteredParents(parents);
        }

        function deleteParentAccount(email) {
            if (confirm('¿Estás segura de que deseas eliminar esta cuenta? Esta acción no se puede deshacer.')) {
                const parents = JSON.parse(localStorage.getItem('registeredParents') || '[]');
                const updatedParents = parents.filter(parent => parent.email !== email);
                localStorage.setItem('registeredParents', JSON.stringify(updatedParents));
                loadParentsAccounts();
                alert('Cuenta eliminada exitosamente.');
            }
        }

        function handleDeleteUsedCodes() {
            if (confirm('¿Estás segura de que deseas invalidar permanentemente todos los códigos usados? Esta acción no se puede deshacer.')) {
                const codes = JSON.parse(localStorage.getItem('invitationCodes') || '[]');
                const updatedCodes = codes.map(codeData => {
                    if (codeData.status === 'Usado') {
                        return {
                            ...codeData,
                            status: 'No válido'
                        };
                    }
                    return codeData;
                });
                localStorage.setItem('invitationCodes', JSON.stringify(updatedCodes));
                loadExistingCodes();
                alert('Códigos usados invalidados exitosamente.');
            }
        }

        // Función para cambiar el tema
        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.classList.contains('dark');
            
            if (isDark) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
        }

        // Cargar tema guardado
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark');
            }
            
            // Agregar evento al botón de tema
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
        });
    </script>
</body>
</html> 